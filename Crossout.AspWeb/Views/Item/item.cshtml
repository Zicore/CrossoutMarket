@{
    Layout = "_Layout";
}

@using System.Collections.Generic
@using System.Linq
@using Crossout.Model.Recipes
@using Crossout.Web
@using Crossout.Web.Helper
@model Crossout.Web.Models.Items.ItemModel

<partial name="header" model="@Model" />
<partial name="status" model="@Model.Status" />

<div class="half-hd-container px-3">
    <div class="card my-1 p-1">
        <div class="media m-1">
            <div class="align-self-center mr-3">
                <a href="~/item/@Model.Item.Id">

                    @if (Model.Item.HighResImageExists)
                    {
                        <img class="item-image-auto-size" src="~/img/items-highres/@Model.Item.Image" />
                    }
                    else if (Model.Item.ImageExists)
                    {
                        <img class="item-image-big" src="~/img/items/@Model.Item.Image" />
                    }
                    else
                    {
                        <img class="item-image-big" src="~/img/NoImage.png" />
                    }
                </a>
            </div>
            <div class="media-body align-self-center">
                <h4>@Model.Item.Name</h4>
                @if (Model.Item.Description != null)
                {
                    <p>@Html.Raw(@Model.Item.Description.Text)</p>
                }
                @*<div>
                        <a href="https://twitter.com/intent/tweet?text=Prices for @(Model.Item.Name)%20Sell:%20@(Model.Item.FormatSellPrice)%20Buy:%20@(Model.Item.FormatBuyPrice)%20Margin:%20@(Model.Item.FormatMargin)&via=CrossoutDB&hashtags=crossout" class="btn btn-xs btn-info" role="button">Tweet Prices</a>
                    </div>*@
            </div>
        </div>
    </div>

    <div class="content-space">
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
             style="display:block"
             data-ad-client="ca-pub-1215488197322962"
             data-ad-slot="4105484332"
             data-ad-format="auto"></ins>
        <script>
            (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
    </div>

    <div class="card my-1">
        <div class="card-header">
            <ul class="nav nav-tabs card-header-tabs" id="itemTab" role="tablist">
                <li class="nav-item">
                    <a class="nav-link active" data-toggle="tab" href="#chart" id="chart-tab" role="tab" aria-controls="chart" aria-selected="true">Chart</a>
                </li>
                @if (Model.Recipe.Recipe.Ingredients.Count > 0)
                {
                    <li class="nav-item">
                        <a class="nav-link" data-toggle="tab" href="#recipe" id="recipe-tab" role="tab" aria-controls="recipe" aria-selected="false">Recipe</a>
                    </li>
                }
                @if (Model.IngredientUsage != null && Model.IngredientUsage.IngredientUsageList.Count > 0)
                {
                    <li class="nav-item">
                        <a class="nav-link" data-toggle="tab" href="#ingredient" id="ingredient-tab" role="tab" aria-controls="ingredient" aria-selected="false">Usage</a>
                    </li>
                }
                @if (Model.Item.Stats != null && Model.Item.Stats.SortedStats.Count > 0)
                {
                    <li class="nav-item">
                        <a class="nav-link" data-toggle="tab" href="#stats" id="stats-tab" role="tab" aria-controls="stats" aria-selected="false">Stats</a>
                    </li>
                }
                @if (Model.Changes.Changes.Count > 0)
                {
                    <li class="nav-item">
                        <a class="nav-link" data-toggle="tab" href="#changes" id="changes-tab" role="tab" aria-controls="changes" aria-selected="false">Changes</a>
                    </li>
                }

            </ul>
        </div>

        <div class="tab-content" id="itemTabContent">

            <div class="tab-pane show active" id="chart" aria-labelledby="chart-tab">
                <partial name="chart" model="@Model" />
            </div>

            @if (Model.Recipe.Recipe.Ingredients.Count > 0)
            {
                <div class="tab-pane" id="recipe" aria-labelledby="recipe-tab">
                    <table class="table table-hover table-condensed">
                        <thead>
                            <tr>
                                <th>
                                    Name
                                </th>
                                <th>
                                    Rarity
                                </th>
                                <th>
                                    <div>Number</div>
                                    <div>Sell Price</div>
                                </th>
                                <th>
                                </th>
                                <th>
                                    <div>Number</div>
                                    <div>Buy Price</div>
                                </th>
                                <th>
                                    Margin
                                </th>
                            </tr>
                        </thead>

                        <tbody>
                            <partial name="recipepart" model="@Model.Recipe.Recipe" />
                        </tbody>
                    </table>
                    <div id="shopping-list-wrapper">
                        <table class="table table-hover table-condensed" id="shopping-list">
                            <thead>
                                <tr>
                                    <th>
                                        Name
                                    </th>
                                    <th>
                                        Rarity
                                    </th>
                                    <th>
                                        Number
                                    </th>
                                    <th>
                                        <div class="rec-right">Sell Price</div>
                                    </th>
                                    <th>
                                    </th>
                                    <th>
                                        <div class="rec-right">Buy Price</div>
                                    </th>
                                </tr>
                            </thead>

                            <tbody></tbody>
                        </table>
                    </div>
                </div>
            }

            @if (Model.IngredientUsage != null && Model.IngredientUsage.IngredientUsageList.Count > 0)
            {
                <div class="tab-pane" id="ingredient" aria-labelledby="ingredient-tab">
                    <table id="ingredientUsageTable" class="table table-hover table-striped table-borderless">
                        <thead>
                            <tr>
                                <th>
                                    Item
                                </th>
                                <th>
                                    Amount
                                </th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var item in Model.IngredientUsage.IngredientUsageList)
                            {
                                <tr>
                                    <td class="align-middle">
                                        <a href="~/item/@item.ItemId">
                                            @if (Model.Changes.ContainedItems[item.ItemId].ImageExists)
                                            {
                                                <img class="item-image-big" src="~/img/items/@(item.ItemId).png" />
                                            }
                                            else
                                            {
                                                <img class="item-image-big" src="~/img/NoImage.png" />
                                            }
                                        </a>
                                        <a href="~/item/@item.ItemId">@(Model.Changes.ContainedItems.ContainsKey(item.ItemId) == true ? Model.Changes.ContainedItems[item.ItemId].Name : item.ItemId.ToString())</a>
                                    </td>
                                    <td class="align-middle">
                                        @item.Amount
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            }

            @if (Model.Item.Stats != null && Model.Item.Stats.SortedStats.Count > 0)
            {

                <div class="tab-pane" id="stats" aria-labelledby="stats-tab">
                    <table class="table table-hover table-striped table-borderless">
                        <thead>
                        </thead>
                        <tbody>
                            @foreach (var item in Model.Item.Stats.SortedStats)
                            {
                                if (item.DisplayValue && item.Stat.Type == Crossout.Data.StatType.Exposed)
                                {
                                    <tr>
                                        <td class="">@item.Stat.Name</td>
                                        <td><partial name="_stat" model="@item" /></td>
                                    </tr>
                                }
                            }
                            @foreach (var item in Model.Item.Stats.SortedStats)
                            {
                                if (item.DisplayValue && item.Stat.Type == Crossout.Data.StatType.Hidden)
                                {
                                    <tr>
                                        <td class="">@item.Stat.Name</td>
                                        <td><partial name="_stat" model="@item" /></td>
                                    </tr>
                                }
                            }
                            </tbody>
                        </table>
                </div>
            }

            @if (Model.Changes.Changes.Count > 0)
            {
                <div class="tab-pane" id="changes" aria-labelledby="changes-tab">
                    <partial name="changesmodular" model="@Model.Changes" />
                </div>
            }
        </div>
    </div>

</div>

<script src="~/scripts/internal/item.js"></script>
<script>
    $(document).ready(function () {
        $('#ingredientUsageTable').DataTable({
            "info": false,
            "paging": false,
            "searching": false,
            autoWidth = true,
            scrollY: 300,
            scrollCollapse: true,
            scroller: {
                loadingIndicator: true
            }
        });

        adjustTimeStamp();
    });

    $.getJSON(location.origin + '/data/recipe/@(Model.Item.Id)',
        function (data) {

           recipeData.data = data;
           recipeData.loaded = true;

            $(".item-0").removeClass("disabled");
        });
</script>
